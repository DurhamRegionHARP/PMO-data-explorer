{"version":3,"sources":["pmo.js","search.js"],"names":["window","document","PMO","data","this","version","anchor","getElementById","name","pmoName","description","slug","split","join","toLowerCase","chartData","estimates","chartsToBuild","Object","keys","container","article","createElement","setAttribute","concat","notes","trendTests","Notes","Trend analysis","Feedback","buildHeader","self","headContainer","header","desc","insertAdjacentText","appendChild","buttons","forEach","chart","button","label","buttonText","push","buttonDiv","ctrlDiv","optionsHint","_i","_Object$entries","entries","class","href","aria-controls","role","length","_Object$entries$_i","_slicedToArray","key","value","btn","idx","buildCharts","chartContainer","chartDiv","className","buildNotes","noteContainer","tabsDiv","panelDiv","_ref","_ref2","noteTab","noteText","noteTitle","Array","isArray","el","insertAdjacentHTML","create","_container","$","Chartist","search","querySelector","index","searchData","task","fetch","then","response","ok","json","snackbar","classList","add","setTimeout","remove","searchFunc","qry","elem","regex","RegExp","test","category","tags","cat","ind","found","indicators","filter","action","amount","message","messageHtml","messageSpan","messageContainer","removeChild","firstChild","parentNode","handleSearchResult","indicator","_indicator","chartName","upper","lower","chartOpts","map","axisX","showGrid","axisY","labelInterpolationFnc","onlyInteger","height","width","high","low","showGridBackground","seriesBarDistance","plugins","errorBars","orientation","confidenceLimit","tooltip","tooltipFnc","meta","metaText","legend","clickable","ctAccessibility","caption","seriesHeader","valueTransform","Bar","chartPadding","right","on","component","type","element","attr","ct:meta","seriesIndex","bind","trigger","addEventListener","event","parent","target","tagName","hasChildNodes","childNodes","buildArticleNode","error","console","log","resetList","list","e","listDiv","toId","clearTimeout","undefined","evt","messageElem","currentQuery","hashString","info","substr","dataLayer","query_string","location","hash","replace","$closeBtn","settings"],"mappings":"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","file":"bundle.js","sourcesContent":["(function(window, document){\n'use strict';\n// PMO indicator instance\nwindow.PMO = function(data){\n  this.version = \"0.6.0\";\n  this.anchor = document.getElementById('cards');\n  this.name = data.pmoName;\n  this.description = data.description;\n  this.slug = data.pmoName.split(' ').join('-').toLowerCase();\n  this.chartData = data.estimates;\n  this.chartsToBuild = Object.keys(data.estimates);\n  this.container = function(){\n    const article = document.createElement('article');\n    article.setAttribute('class', `indicator-block indicator-${this.slug}`);\n    return article;\n  };\n  this.notes = function(){\n    if(!data.trendTests){\n      let notes = {\n        Notes: [\n          'Source: 2018-2019 Ontario Student Drug Use and Health Survey',\n          'Missing bars indicate an estimate is not releaseable due to small numbers'\n        ],\n        Feedback: 'Your comments are welcome through our <a href=\"https://forms.office.com/Pages/ResponsePage.aspx?id=wsnXUknVtkGbH52hmNw_FpdyDt_B3DFNvD4pdKn3uNRUQUZGSUxKTzI3U0taMDVVVjhFWk1UQThQMCQlQCN0PWcu\">feedback form</a>'\n      };\n      return notes;\n    }\n    else {\n      let notes = {\n        Notes: [\n          'Source: 2018-2019 Ontario Student Drug Use and Health Survey',\n          'Missing bars indicate an estimate is not releaseable due to small numbers'\n        ],\n        \"Trend analysis\": data.trendTests,\n        Feedback: 'Your comments are welcome through our <a href=\"https://forms.office.com/Pages/ResponsePage.aspx?id=wsnXUknVtkGbH52hmNw_FpdyDt_B3DFNvD4pdKn3uNRUQUZGSUxKTzI3U0taMDVVVjhFWk1UQThQMCQlQCN0PWcu\">feedback form</a>'\n      };\n      return notes;\n    }      \n  };\n    \n  // Build functions\n  // Get all the Elements ready but do not print to the DOM\n  this.buildHeader = function(){\n    const self = this;\n    const headContainer = document.createElement('div');\n    const header = document.createElement('h3');\n    const desc = document.createElement('p');\n    headContainer.setAttribute('class', 'indicator-header');\n    header.setAttribute('class', 'indicator-title');\n    desc.setAttribute('class', 'indicator-desc');\n    desc.insertAdjacentText('afterbegin', this.description);\n    header.insertAdjacentText('afterbegin', this.name);\n    headContainer.appendChild(header);\n    headContainer.appendChild(desc);\n    // Buttons\n    const buttons = [];\n    Object.keys(this.chartData).forEach(function(chart){\n      let button = document.createElement('button');\n      const buttonText = function(){\n        let label = '';\n        switch(chart){\n          case 'byAll':\n            label  = 'By Response Category';\n            break;\n          case 'byGrade':\n            label  = 'By Grade';\n            break;          \n          case 'bySex':\n            label  = 'By Sex';\n            break;\n          case 'byYear':\n            label  = 'By Year';\n            break;\n        }\n        return label;\n      }\n      button.setAttribute('class', chart == 'byAll' ? 'btn btn-default active wb-toggle' : 'btn btn-default wb-toggle');\n      button.setAttribute('data-toggle', `{ \"selector\": \"#${self.slug}-${chart}\",\"group\": \".chart-${self.slug}\",\"type\": \"on\"}`);\n      button.insertAdjacentText('afterbegin', buttonText());\n      buttons.push(button);\n    })\n    const buttonDiv = document.createElement('div');\n    const ctrlDiv = document.createElement('div');\n    const optionsHint = document.createElement('a');\n    const optionsHintAttrs = {\n      class: 'btn btn-sm btn-default overlay-lnk',\n      href: '#options-hint',\n      \"aria-controls\": 'options-hint',\n      role: 'button'\n    };\n    optionsHint.insertAdjacentText('afterbegin', '?');\n    for (let [key, value] of Object.entries(optionsHintAttrs)){\n      optionsHint.setAttribute(key, value);\n    }\n    ctrlDiv.setAttribute('class', 'view-control');\n    buttonDiv.setAttribute('class', 'view-mode-control btn-group-sm btn-group');\n    buttons.forEach(function(btn, idx){\n      buttonDiv.appendChild(btn);\n    });\n    ctrlDiv.appendChild(buttonDiv);\n    ctrlDiv.appendChild(optionsHint);\n    headContainer.appendChild(ctrlDiv);\n    return headContainer;\n  }\n  this.buildCharts = function(){\n    const self = this;\n    const chartContainer = document.createElement('div');\n    chartContainer.setAttribute('class', 'indicator-chart');\n    Object.keys(this.chartData).forEach(function(chart){\n      let chartDiv = document.createElement('div');\n      chartDiv.setAttribute('id', `${self.slug}-${chart}`);\n      chartDiv.setAttribute('class', `chart chart-${self.slug}`);\n      if(chart === 'byAll'){\n        chartDiv.className += ' on';\n      }\n      chartContainer.appendChild(chartDiv);\n    });\n    return chartContainer;\n  } \n  this.buildNotes = function(){\n    const noteContainer = document.createElement('div');\n    noteContainer.setAttribute('class', 'indicator-footer');\n    const tabsDiv = document.createElement('div');\n    tabsDiv.setAttribute('class', 'wb-tabs');\n    const panelDiv = document.createElement('div');\n    panelDiv.setAttribute('class', 'tabpanels');\n    Object.entries(this.notes()).forEach(function([key, value]){\n      let noteTab = document.createElement('details');\n      noteTab.setAttribute('class', `tab-${key.toLowerCase()}`);\n      let noteTitle = document.createElement('summary');\n      noteTitle.insertAdjacentText('afterbegin', key);\n      if(Array.isArray(value)){\n        noteTab.appendChild(noteTitle);\n        value.forEach(function(el){\n          let noteText = document.createElement('p');\n          noteText.insertAdjacentText('afterbegin', el);\n          noteTab.appendChild(noteText);             \n        })\n      }else{\n        let noteText = document.createElement('p');\n        noteText.insertAdjacentHTML('afterbegin', value);\n        noteTab.appendChild(noteTitle);\n        noteTab.appendChild(noteText);\n      }\n      panelDiv.appendChild(noteTab);\n    });\n    tabsDiv.appendChild(panelDiv);\n    noteContainer.appendChild(tabsDiv);\n    return noteContainer;\n  }\n  this.create = function(){\n    const _container = this.container();\n    _container.appendChild(this.buildHeader());\n    _container.appendChild(this.buildCharts());\n    _container.appendChild(this.buildNotes());\n    this.anchor.appendChild(_container);\n  }\n};\n})(window, document);\n","/*\n * Search for indicators and create an article with data from pmo.js\n */\n(function($, window, document, Chartist, PMO){\n  'use strict';\n  // define the elements of interest\n  const search = document.querySelector('.search-text');\n  const index = document.querySelector('.index-container');\n  // Search the data\n  function searchData(task){\n    fetch('https://cdn.jsdelivr.net/gh/DurhamRegionHARP/PMO-data-explorer@gh-pages/_data/pmo.json')\n      .then(function(response){\n        if(!response.ok){\n          const snackbar = document.getElementById('snackbar-error');\n          snackbar.classList.add('show');\n          // Remove the \"show\" class after 3 seconds\n          setTimeout(function(){\n            snackbar.classList.remove('show');\n          }, 3000); \n        } else {\n          return response.json();\n        }\n      })\n      .then(function(data){\n        const searchFunc = {\n          qry: function(elem){\n            const regex = new RegExp(task.value, 'i');\n            if (regex.test(elem.pmoName) || regex.test(elem.category) || regex.test(elem.description) || regex.test(elem.tags.join(' '))){\n              return elem;\n            }\n          },\n          cat: function(elem){\n            if (elem.category.split(' ').join('-').toLowerCase() === task.value){\n              return elem;\n            }\n          },\n          ind: function(elem){\n            if (elem.pmoName.split(' ').join('-').toLowerCase() === task.value){\n              return elem;\n            }\n          }\n        }  \n        const found = data.indicators.filter( searchFunc[task.action] );\n        if(task.action === 'qry'){\n          handleSearchResult(found);\n        }\n        found.forEach(function(el){\n          buildArticleNode(el);\n        });           \n      })\n      .catch(function(error){\n        console.log(error);\n        const snackbar = document.getElementById('snackbar-error');\n        snackbar.classList.add('show');\n        // Remove the \"show\" class after 3 seconds\n        setTimeout(function(){\n          snackbar.classList.remove('show');\n        }, 3000);\n      });\n  }\n  // Handle the result\n  // TODO:\n  //  - Google analytics log this query -> query = search.value.trim()\n  function handleSearchResult(data){\n    const amount = data.length;\n    const message = document.createElement('p');\n    let messageHtml = amount + ' result' + ( amount === 1 ? '' : 's') + ' found';\n    if (amount === 0){\n      messageHtml += '<p>Why not <a href=\"#\">suggest</a> this topic be added?</p>';\n    }\n    message.insertAdjacentHTML('afterbegin', messageHtml);\n    // Check whether a \"search-feedback\" element exists\n    const messageSpan = document.querySelector('.search-feedback');\n    if(messageSpan){\n      // We've got a message on screen already\n      // remove the former and add the current\n      messageSpan.removeChild(messageSpan.firstChild);\n      messageSpan.appendChild(message);\n      search.parentNode.appendChild(messageSpan);\n    }\n    else{\n      // \"search-feedback\" element does not exist\n      // Create it\n      const messageContainer = document.createElement('span');\n      messageContainer.setAttribute('class', 'search-feedback');\n      messageContainer.appendChild(message);\n      search.parentNode.appendChild(messageContainer);\n    }\n  }\n  // Reset the search\n  function resetSearch(){\n    const messageElem = document.querySelector('.search-feedback');\n    if(messageElem){\n      search.parentNode.removeChild(messageElem);\n    }\n  }\n  // Reset the indicator block\n  function resetList(){\n    const list = document.getElementById('cards');\n    while(list.firstChild){ \n      list.removeChild(list.firstChild);\n    }\n  }\n  // Build the article\n  function buildArticleNode(indicator){\n    // Only build if an indicator block does not exist\n    const _indicator = new PMO(indicator);\n    let article = document.querySelector('.indicator-' + _indicator.slug);\n    if (!article){\n      _indicator.create();\n      _indicator.chartsToBuild.forEach(function(chart){\n        buildArticleCharts(`#${_indicator.slug}-${chart}`, _indicator.chartData[chart]);\n      });\n      let article = document.querySelector('.indicator-' + _indicator.slug);\n      article.addEventListener('click', function(event){\n        if(event.target.tagName === 'BUTTON'){\n          const parent = event.target.parentNode;\n          if(parent.hasChildNodes()){\n            parent.childNodes.forEach(function(button){\n              button.classList.remove('active');\n            });\n          }\n          event.target.classList.add('active');\n        }\n      });\n    }\n  }\n  function buildArticleCharts(chartName, data){\n    const upper = data['series'].map(function(el){\n      return el['cl'].map(function(el){\n        return el[0];\n      });\n    });\n    const lower = data['series'].map(function(el){\n      return el['cl'].map(function(el){\n        return el[1];\n      });\n    });\n    const notes = data['series'].map(function(el){\n      return el['notes'];\n    });\n    const chartOpts = {\n      axisX : {\n        showGrid: false\n      },\n      axisY : {\n        labelInterpolationFnc: function(value){\n          return value + '%';\n        },\n        onlyInteger: true\n      },\n      height: '250px',\n      width: '1100px',\n      high: 100,\n      low: 0,\n      showGridBackground: true,\n      seriesBarDistance: 22,\n      plugins: [\n        Chartist.plugins.errorBars({\n          orientation: 'vertical',\n          confidenceLimit: {\n            upper: upper,\n            lower: lower\n          }\n        }),\n        Chartist.plugins.tooltip({\n          tooltipFnc: function(meta, value){\n            let metaText = (meta == \"null\") ? \"\" : `<br>${meta}`;\n            return `${value}%${metaText}`;\n          }\n        }),\n        Chartist.plugins.legend({\n          className: \"list-inline\",\n          clickable: false\n        }),\n        Chartist.plugins.ctAccessibility({\n          caption: 'OSDUHS Results',\n          seriesHeader: 'Analysis group',\n          valueTransform: function(value){\n            return value + '%';\n          }\n        })\n      ]\n    };\n    const responsiveOpts = [\n      ['screen and (max-width: 767px)', {\n        width: '650px',\n        seriesBarDistance: 15,\n        chartPadding: {\n          right: 25\n        }\n      }],\n      ['screen and (min-width: 768px)', {\n        width: '680px',\n        seriesBarDistance: 22,\n      }],\n      ['screen and (min-width: 992px)', {\n        seriesBarDistance: 22,\n        width: '900px',\n      }],\n      ['screen and (min-width: 1200px)', {\n        seriesBarDistance: 22,\n        width: '1100px',\n      }],\n    ];\n    let chart = new Chartist.Bar(chartName, data, chartOpts, responsiveOpts);\n    chart.on('draw', function(component){\n      if (component.type === 'bar'){\n        component.element.attr({ \"ct:meta\": this[component.seriesIndex][component.index] });\n      }\n    }.bind(notes));\n    $(\".wb-toggle\").trigger(\"wb-init.wb-toggle\");\n    $(\".wb-tabs\").trigger(\"wb-init.wb-tabs\");\n  }\n  document.addEventListener('DOMContentLoaded', function(){\n    search.addEventListener('input', function(e){\n      let listDiv = document.getElementById('cards');\n      listDiv.setAttribute('class', 'indicator-list');\n      if(typeof this.toId === 'number'){\n        clearTimeout(this.toId);\n        this.toId = undefined;\n      }\n      resetList();\n      this.toId = setTimeout(function(evt){\n        let currentQuery = evt.target.value;\n        if(!currentQuery.length){\n          resetSearch();\n          listDiv.classList.remove('indicator-list');\n          return;\n        }\n        const hashString = `#qry=${currentQuery}`;\n        const info = hashString.substr(1).split(\"=\");\n        dataLayer.push({\n          'event': 'query',\n          'query_string': info[1]\n        });\n        window.location.hash = hashString;\n        searchData({\n          action: info[0],\n          value: info[1].replace(/[.*+\\-?^${}()|[\\]\\\\]/g, '\\\\$&') // thanks to: developer.mozilla.org\n        });\n      }.bind(this), 600, e);\n    });\n    index.addEventListener('click', function(e){\n      if(e.target.className === \"index-link\"){\n        resetList();\n        let listDiv = document.getElementById('cards');\n        listDiv.setAttribute('class', 'indicator-list');  \n        const hashString = e.target.hash;\n        const info = hashString.substr(1).split(\"=\");\n        const $closeBtn = $(\"#close-index\");\n        const settings = $closeBtn.data(\"toggle\");\n        window.location.hash = e.target.hash;\n        searchData({\n          action: info[0],\n          value: info[1],\n        });\n        // Simulatle closing the data index as this will\n        // take up a lot of real estate \n        $closeBtn.trigger(\"toggle.wb-toggle\", settings);\n      }      \n    });\n  });\n})($, window, document, Chartist, PMO);\n"]}
